{% extends 'pharmacy/base.html' %}
{% load static %}

{% block title %}Payment - HopeWell Pharma{% endblock %}

{% block extra_js %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-4">Complete Your Payment</h1>
        <p class="text-gray-600 mb-6">Order #{{ order.id }} - Total: ₹{{ order.total }}</p>
        
        <button id="rzp-button1" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-opacity-90 transition-all">
            Pay ₹{{ order.total }}
        </button>
    </div>
</div>

<script>
var options = {
    "key": "{{ razorpay_key_id }}",
    "amount": "{{ amount }}", // already in paise
    "currency": "INR",
    "name": "HopeWell Pharma",
    "description": "Order #{{ order.id }}",
    "order_id": "{{ razorpay_order_id }}",  <!-- Important -->
    "handler": function (response){
        window.location.href = "{% url 'payment_success' order.id %}?payment_id=" + response.razorpay_payment_id;
    },
    "prefill": {
        "name": "{{ order.user.get_full_name|default:order.user.username }}",
        "email": "{{ order.user.email }}",
        "contact": "{{ order.user.profile.phone|default:'' }}"
    },
    "notes": {
        "address": "{{ order.address.street_address }}, {{ order.address.city }}"
    },
    "theme": {
        "color": "#0F9E99"
    }
};

document.getElementById('rzp-button1').onclick = function(e){
    var rzp1 = new Razorpay(options);
    rzp1.open();
    e.preventDefault();
};
</script>
{% endblock %}
